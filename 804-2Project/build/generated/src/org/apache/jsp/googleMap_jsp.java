package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import MapBean.*;
import java.util.*;

public final class googleMap_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static java.util.List _jspx_dependants;

  public Object getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse response)
        throws java.io.IOException, ServletException {

    JspFactory _jspxFactory = null;
    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;
    PageContext _jspx_page_context = null;


    try {
      _jspxFactory = JspFactory.getDefaultFactory();
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("<html>\n");
      out.write("    <head>\n");
      out.write("        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n");
      out.write("        <title>地圖日記</title>\n");
      out.write("        <script src=\"prototype.js\" type=\"text/javascript\"></script>\n");
      out.write("        <script src=\"scriptaculous.js\" type=\"text/javascript\"></script>\n");
      out.write("        <script src=\"unittest.js\" type=\"text/javascript\"></script>\n");
      out.write("        <script src=\"http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAQ6jnIFRl7xVahR25heKAqhRuoDWqNw2SaEQ3s6k_JjRa-mj9QBTWWvHGO9t2-a-Nrj-NJQRLvClSyA\"\n");
      out.write("                type=\"text/javascript\"></script>\n");
      out.write("        <script src=\"googleMap.js\" type=\"text/javascript\"></script>\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("        \n");
      out.write("    //<![CDATA[\n");
      out.write("       \n");
      out.write("    var map;\n");
      out.write("    var geocoder = null;\n");
      out.write("    function load() {\n");
      out.write("      if (GBrowserIsCompatible()) {\n");
      out.write("        map = new GMap2(document.getElementById(\"map\"));\n");
      out.write("        geocoder = new GClientGeocoder();\n");
      out.write("        \n");
      out.write("        map.addControl(new GLargeMapControl());\n");
      out.write("        map.addControl(new GMapTypeControl());\n");
      out.write("        map.setCenter(new GLatLng(23.074678,120.189743),12);\n");
      out.write("        GEvent.addListener(map,\"move\",getXYAxis);\n");
      out.write("        getFile('label.xml');//一次載入所有駐點,function:getFile();\n");
      out.write("        }\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function getXYAxis(){\n");
      out.write("        var latLng = map.getCenter();\n");
      out.write("        document.getElementById(\"mapX\").value = latLng.lat();\n");
      out.write("        document.getElementById(\"mapY\").value = latLng.lng();\n");
      out.write("    }\n");
      out.write("   \n");
      out.write("    function sendValue(x,y,name,msg){\n");
      out.write("        document.getElementById(\"mapX\").value = x;\n");
      out.write("        document.getElementById(\"mapY\").value = y;\n");
      out.write("        map.setCenter(new GLatLng(x,y),12);\n");
      out.write("        addSite(map,12,name,x,y);\n");
      out.write("        showInfo(msg);\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function addNewLabel(){\n");
      out.write("        var label = document.getElementById(\"siteName\").value;\n");
      out.write("        var x = document.getElementById(\"mapX\").value;\n");
      out.write("        var y = document.getElementById(\"mapY\").value;\n");
      out.write("        addSite(map,12,label,x,y);\n");
      out.write("       \n");
      out.write("    }\n");
      out.write("     \n");
      out.write("    function addSite(map, siteCode, siteDesc, lat, lng) {\n");
      out.write("        var mark = new GMarker(\n");
      out.write("        new GLatLng(lat,lng),\n");
      out.write("        {title:siteDesc}\n");
      out.write("        );  \n");
      out.write("        map.addOverlay(mark);  \n");
      out.write("        }\n");
      out.write("    \n");
      out.write("        \n");
      out.write("     function showInfo(msg){\n");
      out.write("         var loc = map.getCenter();\n");
      out.write("         map.openInfoWindowHtml(loc,msg,new GSize(10,20));\n");
      out.write("         }\n");
      out.write("      \n");
      out.write("   \n");
      out.write("      function showLocation() { //search address(1)\n");
      out.write("        \n");
      out.write("        var address = document.getElementById('address').value; \n");
      out.write("        geocoder.getLocations(address, cb_showLocation);\n");
      out.write("      }\n");
      out.write("      \n");
      out.write("      function setDefaultLocation(){\n");
      out.write("        var address = document.getElementById('defalutLocation').value;\n");
      out.write("        geocoder.getLocations(address, cb_showLocation);\n");
      out.write("        \n");
      out.write("        var loc = map.getCenter();\n");
      out.write("        var x = loc.lat();\n");
      out.write("        var y = loc.lng();\n");
      out.write("        var parm = \"x=\"+x+\"&\"+\"y=\"+y;\n");
      out.write("        var url = \"setDefaultLocation.jsp?\"+parm;\n");
      out.write("        var myAjax = new Ajax.Request(\n");
      out.write("                url,\n");
      out.write("                {   method:'post',\n");
      out.write("                    onComplete:setDefaultLocation_do}\n");
      out.write("                );\n");
      out.write("        \n");
      out.write("      }\n");
      out.write("      \n");
      out.write("      function setDefaultLocation_do(xmlhttp){\n");
      out.write("            var out=\"\";\n");
      out.write("            var result = xmlhttp.responseXML.getElementsByTagName(\"result\");\n");
      out.write("            for(var i = 0; i < result.length;i++){\n");
      out.write("                out += result[i].firstChild.nodeValue;\n");
      out.write("            }\n");
      out.write("            document.getElementById('result').innerHTML = out;\n");
      out.write("      }\n");
      out.write("      \n");
      out.write("      function cb_showLocation(result){//search address(2)\n");
      out.write("        var result1 = document.getElementById(\"result\");\n");
      out.write("        if (result.Status.code == G_GEO_SUCCESS)  { \n");
      out.write("        for (var i=0; i<result.Placemark.length; i++) { \n");
      out.write("        var lat = result.Placemark[i].Point.coordinates[1]; // lat \n");
      out.write("        var lng = result.Placemark[i].Point.coordinates[0]; // lng \n");
      out.write("        var address = result.Placemark[i].address; // address \n");
      out.write("        var point = new GLatLng(lat,lng);\n");
      out.write("        var marker=new GMarker(point, {title:i+1});;\n");
      out.write("        map.addOverlay(marker); \n");
      out.write("        document.getElementById(\"mapX\").value = lat;\n");
      out.write("        document.getElementById(\"mapY\").value = lng;\n");
      out.write("        map.setCenter(new GLatLng(lat,lng),12);\n");
      out.write("        }\n");
      out.write("        }\n");
      out.write("      }\n");
      out.write("      \n");
      out.write("        function  getFile(filename){//一次載入所有駐點\n");
      out.write("            var myAjax = new Ajax.Request(\n");
      out.write("                filename,\n");
      out.write("                {method:\"get\",onComplete: getFile2}\n");
      out.write("            );\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        function getFile2(xmlhttp){//一次載入所有駐點do\n");
      out.write("            var out=\"\";\n");
      out.write("            var i;\n");
      out.write("           \n");
      out.write("            var xmlDoc = xmlhttp.responseXML;\n");
      out.write("            var label = xmlDoc.getElementsByTagName('label');\n");
      out.write("            for(i=0;i < label.length;i++){\n");
      out.write("               var lat = label[i].getAttribute(\"lat\");\n");
      out.write("               var lng = label[i].getAttribute(\"lng\");\n");
      out.write("               var name = label[i].getAttribute(\"name\");\n");
      out.write("               addSite(map, 12, name, lat, lng);\n");
      out.write("              \n");
      out.write("            }\n");
      out.write("         \n");
      out.write("       \n");
      out.write("        }\n");
      out.write("       \n");
      out.write("        //]]>           \n");
      out.write("    \n");
      out.write("\n");
      out.write("       \n");
      out.write("\n");
      out.write("       \n");
      out.write("\t   \n");
      out.write("\n");
      out.write("          \n");
      out.write("\n");
      out.write(" \n");
      out.write("    \n");
      out.write("    \n");
      out.write("   \n");
      out.write("                                               </script>\n");
      out.write("        \n");
      out.write("        <style type=\"text/css\">\n");
      out.write("            <!--\n");
      out.write("body {\n");
      out.write("\tmargin-left: 0px;\n");
      out.write("\tmargin-top: 0px;\n");
      out.write("\tmargin-right: 0px;\n");
      out.write("\tmargin-bottom: 0px;\n");
      out.write("}\n");
      out.write("\n");
      out.write("\n");
      out.write("            -->\n");
      out.write("        </style>\n");
      out.write("        \n");
      out.write("    </head>\n");
      out.write("    <body onload=\"load()\" onunload=\"GUnload()\">\n");
      out.write("        <table>\n");
      out.write("            <tr>\n");
      out.write("                <td><div id=\"map\" style=\"width: 500px; height: 300px;border:solid 1px #6699FF;\"></div></td>\n");
      out.write("                <td>\n");
      out.write("                    <div id=\"label\"  style=\"width:130;height:200;overflow:scroll;position:relative;\">\n");
      out.write("                        <ul id=\"list\" style=\"padding: 2px;list-style-type:none;border:solid 1px #6699FF;\">\n");
      out.write("                            ");

                            mapBean control = new mapBean();
                            Collection ret = control.getAllLabel();
                            Iterator it = ret.iterator();
                            while(it.hasNext()){
                                mapVO map = (mapVO)it.next();
                            
      out.write("    \n");
      out.write("                            \n");
      out.write("                            <li  ondblclick=\"sendValue(");
      out.print(map.getX());
      out.write(',');
      out.print(map.getY());
      out.write(',');
      out.print(map.getId());
      out.write(',');
      out.write('\'');
      out.print(map.getInfo());
      out.write("')\"><div  onmousemove=\"style.background='#FFCC66';style.cursor='pointer'\" onmouseout=\"style.background='#CCCCFF'\" style=\"background='#CCCCFF'\"  id=\"");
      out.print(map.getId());
      out.write('"');
      out.write('>');
      out.print(map.getName());
      out.write("</div></li>\n");
      out.write("                            \n");
      out.write("                            ");
}
      out.write("     \n");
      out.write("                        </ul>\n");
      out.write("                        \n");
      out.write("                        \n");
      out.write("                        \n");
      out.write("                        \n");
      out.write("                    </div>\n");
      out.write("                </td>\n");
      out.write("                <td><iframe name =\"addLabel\" src=\"googleFunction.jsp\" scrolling=\"no\" frameborder=\"0\" width=\"200\" height=\"300\"></iframe></td>\n");
      out.write("            </tr>\n");
      out.write("            \n");
      out.write("            \n");
      out.write("            \n");
      out.write("        </table>\n");
      out.write("        \n");
      out.write("        <table>\n");
      out.write("            <tr>\n");
      out.write("                <form name=\"value\">\n");
      out.write("                    <td>X座標:<input type=\"text\" id=\"mapX\" style=\"background:yellow\" size=\"15\"></td>\n");
      out.write("                    <td> Y座標:<input type=\"text\" id=\"mapY\" style=\"background:yellow\" size=\"15\"></td>\n");
      out.write("                    \n");
      out.write("                    \n");
      out.write("                    \n");
      out.write("                </form>\n");
      out.write("                \n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <a href=\"\" onclick=\"Print()\">列印</a>\n");
      out.write("                <td>定位:<input type=text name=\"address\"></td>\n");
      out.write("                <td><input type=button id=\"address\" onclick=\"showLocation()\" value=\"送出\"></td>\n");
      out.write("                \n");
      out.write("                \n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td>設定預設位置<input type=text id=\"defalutLocation\" name=\"location\"></td>\n");
      out.write("                <td><input type=submit value=\"儲存\" onclick=\"setDefaultLocation()\"></td>\n");
      out.write("                <td><div id=\"result\" name=\"result\">here is result:</div></td>\n");
      out.write("            </tr>\n");
      out.write("                <input type=\"button\" value=\"測試\" onclick=\"getFile('label.xml')\">\n");
      out.write("            \n");
      out.write("            \n");
      out.write("            \n");
      out.write("            \n");
      out.write("        </table>\n");
      out.write("        \n");
      out.write("        \n");
      out.write("        \n");
      out.write("        <script type=\"text/javascript\" language=\"javascript\" charset=\"utf-8\">\n");
      out.write("// <![CDATA[\n");
      out.write("                                      \n");
      out.write("Position.includeScrollOffsets = true; \n");
      out.write("Sortable.create('list',{scroll:'label'});\n");
      out.write("\n");
      out.write("  \n");
      out.write("\n");
      out.write("// ]]>\n");
      out.write("        </script>\n");
      out.write("        \n");
      out.write("    </body>\n");
      out.write("</html>\n");
    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          out.clearBuffer();
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
      }
    } finally {
      if (_jspxFactory != null) _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
